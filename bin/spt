#!/bin/bash
# Spatelier CLI entry point.
# This is the main entry point for the spatelier command-line tool.
# Works from any directory by automatically finding the project and virtual environment.

# Get the directory containing this script
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"
VENV_PYTHON="$PROJECT_ROOT/venv/bin/python"

# Check if virtual environment exists
if [ ! -f "$VENV_PYTHON" ]; then
    echo "Error: Virtual environment not found at $VENV_PYTHON"
    echo "Please run 'make setup' to install dependencies."
    exit 1
fi

# Check if the CLI module exists
if [ ! -f "$PROJECT_ROOT/cli/app.py" ]; then
    echo "Error: CLI module not found at $PROJECT_ROOT/cli/app.py"
    echo "Please ensure you're running this from the correct project directory."
    exit 1
fi

# Run the CLI using the virtual environment's Python
exec "$VENV_PYTHON" -c "
import sys
from pathlib import Path

# Add project root to Python path
project_root = Path('$PROJECT_ROOT')
sys.path.insert(0, str(project_root))

# Import and run the main CLI app
from cli.app import app
app()
" "$@"
